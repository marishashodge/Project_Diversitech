<!DOCTYPE html>

<head>
    <title>d3 Interactive Pie Chart</title>
    <link href="http://netdna.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet">
    <script src="https://code.jquery.com/jquery.js"></script>
    <script type="text/javascript" src="https://www.google.com/jsapi"></script>
    <script src="http://d3js.org/d3.v3.min.js"></script>

</head>
<style>

#chart {                                                          /* NEW */
       height: 360px;                                                  /* NEW */
       position: relative;                                             /* NEW */
       width: 360px;                                                   /* NEW */
     }                                                                 /* NEW */
.tooltip {                                                        /* NEW */
 background: #eee;                                               /* NEW */
 box-shadow: 0 0 5px #999999;                                    /* NEW */
 color: #333;                                                    /* NEW */
 display: none;                                                  /* NEW */
 font-size: 12px;                                                /* NEW */
 left: 130px;                                                    /* NEW */
 padding: 10px;                                                  /* NEW */
 position: absolute;                                             /* NEW */
 text-align: center;                                             /* NEW */
 top: 95px;                                                      /* NEW */
 width: 80px;                                                    /* NEW */
 z-index: 10;                                                    /* NEW */
}                                                                 /* NEW */
.legend {
 font-size: 12px;
}
rect {
 stroke-width: 2;
}

body {
    font-family:"Helvetica Neue", Helvetica, Arial, sans-serif;
    margin: auto;
    /*position: relative;*/
    /*width: 1800px;*/
}
text {
    font: 10px sans-serif;
}
form {
    position: absolute;
    right: 10px;
    top: 10px;
}
</style>
<script src="http://d3js.org/d3.v3.min.js"></script>

<body>
    <div class="container-fluid">


        <div class="row vertBuffer20" id="choices">
            <!-- <input type="radio" name="radData" id="rad1" value="data1" checked="checked" onclick='change1(data1); change2(data3);' />
            <label for="rad1">Data1</label>

            <input type="radio" name="radData" id="rad2" value="data2" onclick='change1(data2); change2(data4);' />
            <label for="rad2">Data2</label> -->
            <!-- </br> -->


        </div>
        <div class="row vertBuffer20">
          <div id='chartDiv'></div>
        </div>
        <div class="row vertBuffer20">

            <div id='chartDiv2'></div>
        </div>

    </div>




</body>
<script type="text/javascript">
//company overall
var data1 = [{
  "label": "Female",
  "count": {{ data1 }} },

  {"label": "Male",
  "count": {{ data2 }} }
];
//company tech

if ({{ data3 }} != 0) {
var data2 = [{
  "label": "Female",
  "count": {{ data3 }} },

  {"label": "Male",
  "count": {{ data4 }} }
]
;
$('#choices').html("<input type='radio' name='radData' id='rad1' value='data1' checked='checked' onclick='change1(data1); change2(data3);' /><label for='rad1'>Overall</label><input type='radio' name='radData' id='rad2' value='data2' onclick='change1(data2); change2(data4);'/><label for='rad2'>Tech</label>")

}




// average overall
var data3 = [{

"label": "Female",
"count": {{ data5 }} },

{"label": "Male",
"count": {{ data6 }} }
]
;

if ({{ data3 }} != 0) {
// average tech
var data4 = [{

"label": "Female",
"count": {{ data7 }} },

{"label": "Male",
"count": {{ data8 }} }
]
;
}
// function chart1() {
    ////

    /////

    console.log(data1, data2, data3, data4)


    var width = 800,
    height = 250,
    radius = Math.min(width, height) / 2;
    var legendRectSize = 18;                                  // NEW
    var legendSpacing = 4;                                    // NEW

    var color = d3.scale.ordinal()
    .range(["#98abc5", "#8a89a6", "#7b6888", "#6b486b", "#a05d56", "#d0743c", "#ff8c00"]);

    var arc = d3.svg.arc()
    .outerRadius(radius - 10)
    .innerRadius(radius - 50);

    var pie = d3.layout.pie()
    .sort(null)
    .value(function(d) {
    return d.count;
    });

    var pie2 = d3.layout.pie()
    .sort(null)
    .value(function(d) {
    return d.count;
    });

    var tooltip = d3.select('#chartDiv')                               // NEW
    .append('div')                                                // NEW
    .attr('class', 'tooltip');

    tooltip.append('div')                                           // NEW
    .attr('class', 'label');                                      // NEW

    tooltip.append('div')                                           // NEW
    .attr('class', 'count');                                      // NEW

    tooltip.append('div')
    .attr('class', 'percent');                                         // NEW

    var tooltip2 = d3.select('#chartDiv2')                               // NEW
    .append('div')                                                // NEW
    .attr('class', 'tooltip');

                                   // NEW

    tooltip2.append('div')                                           // NEW
    .attr('class', 'label');                                      // NEW

    tooltip2.append('div')                                           // NEW
    .attr('class', 'count');                                      // NEW

    tooltip2.append('div')                                           // NEW
    .attr('class', 'percent');


    var svg = d3.select("#chartDiv").append("svg")
    .attr("width", width)
    .attr("height", height)
    .append("g")
    .attr("id", "pieChart")
    .attr("transform", "translate(" + width / 2 + "," + height / 2 + ")");
///// Begin
    var svg2 = d3.select("#chartDiv2").append("svg")
    .attr("width", width)
    .attr("height", height)
    .append("g")
    .attr("id", "pieChart")
    .attr("transform", "translate(" + width / 2 + "," + height / 2 + ")");
//////////// End
    var path = svg.selectAll("path")
    .data(pie(data1))
    .enter()
    .append("path");

    path.transition()
    .duration(500)
    .attr("fill", function(d, i) {
    return color(d.data.label);
    })
    .attr("d", arc)
    .each(function(d) {
    this._current = d;
    }); // store the initial angles

    path.on('mouseover', function(d) {                            // NEW
    var total = d3.sum(data1.map(function(d) {                // NEW
    return d.count;                                           // NEW
    }));                                                        // NEW
    var percent = Math.round(1000 * d.data.count / total) / 10; // NEW
    tooltip.select('.label').html(d.data.label);                // NEW
    // tooltip.select('.count').html(d.data.count);                // NEW
    tooltip.select('.percent').html(percent + '%');             // NEW
    tooltip.style('display', 'block');                          // NEW
    });                                                           // NEW

    path.on('mouseout', function() {                              // NEW
    tooltip.style('display', 'none');                           // NEW
    });
  //// Begin
  var path2 = svg2.selectAll("path")
  .data(pie2(data3))
  .enter()
  .append("path");
  /////////// End




    path2.transition()
    .duration(500)
    .attr("fill", function(d, i) {
    return color(d.data.label);
    })
    .attr("d", arc)
    .each(function(d) {
    this._current = d;
    }); // store the initial angles

    path2.on('mouseover', function(d) {                            // NEW
    var total = d3.sum(data3.map(function(d) {                // NEW
    return d.count;                                           // NEW
    }));                                                        // NEW
    var percent = Math.round(1000 * d.data.count / total) / 10; // NEW
    tooltip2.select('.label').html(d.data.label);                // NEW
    // tooltip.select('.count').html(d.data.count);                // NEW
    tooltip2.select('.percent').html(percent + '%');             // NEW
    tooltip2.style('display', 'block');                          // NEW
    });                      // NEW

    path2.on('mouseout', function() {                              // NEW
    tooltip2.style('display', 'none');                           // NEW
    });

    var legend = svg.selectAll('.legend')                     // NEW
    .data(color.domain())                                   // NEW
    .enter()                                                // NEW
    .append('g')                                            // NEW
    .attr('class', 'legend')                                // NEW
    .attr('transform', function(d, i) {                     // NEW
    var height = legendRectSize + legendSpacing;          // NEW
    var offset =  height * color.domain().length / 2;     // NEW
    var horz = -2 * legendRectSize;                       // NEW
    var vert = i * height - offset;                       // NEW
    return 'translate(' + horz + ',' + vert + ')';        // NEW
    });

    legend.append('rect')                                     // NEW
    .attr('width', legendRectSize)                          // NEW
    .attr('height', legendRectSize)                         // NEW
    .style('fill', color)                                   // NEW
    .style('stroke', color);                                // NEW

    legend.append('text')                                     // NEW
    .attr('x', legendRectSize + legendSpacing)              // NEW
    .attr('y', legendRectSize - legendSpacing)              // NEW
    .text(function(d) { return d; });                       // NEW

    var legend2 = svg2.selectAll('.legend')                     // NEW
    .data(color.domain())                                   // NEW
    .enter()                                                // NEW
    .append('g')                                            // NEW
    .attr('class', 'legend')                                // NEW
    .attr('transform', function(d, i) {                     // NEW
    var height = legendRectSize + legendSpacing;          // NEW
    var offset =  height * color.domain().length / 2;     // NEW
    var horz = -2 * legendRectSize;                       // NEW
    var vert = i * height - offset;                       // NEW
    return 'translate(' + horz + ',' + vert + ')';        // NEW
    });                                                     // NEW
                                               // NEW

    legend2.append('rect')                                     // NEW
    .attr('width', legendRectSize)                          // NEW
    .attr('height', legendRectSize)                         // NEW
    .style('fill', color)                                   // NEW
    .style('stroke', color);                                // NEW

    legend2.append('text')                                     // NEW
    .attr('x', legendRectSize + legendSpacing)              // NEW
    .attr('y', legendRectSize - legendSpacing)              // NEW
    .text(function(d) { return d; });                       // NEW                                    // NEW


    function change1(data) {
    path.data(pie(data));
    path.transition().duration(750).attrTween("d", arcTween); // redraw the arcs
    };

    function change2(data) {
    path2.data(pie(data));
    path2.transition().duration(750).attrTween("d", arcTween2); // redraw the arcs
    };


    // Store the displayed angles in _current.
    // Then, interpolate from _current to the new angles.
    // During the transition, _current is updated in-place by d3.interpolate.

function arcTween(a) {
var i = d3.interpolate(this._current, a);
this._current = i(0);
return function(t) {
return arc(i(t));
};
};


function arcTween2(a) {
var i = d3.interpolate(this._current, a);
this._current = i(0);
return function(t) {
return arc(i(t));
};

};

// };







//
// ////
// var data3 = [{
//             "label": "Female",
//             "count": {{ data4 }} },
//
//             {"label": "Male",
//             "count": {{ data5 }} }
//           ]
//
// var data4 = [{
//             "label": "Female",
//             "count": {{ data6 }} },
//
//             {"label": "Male",
//             "count": {{ data7 }} }
//           ]
// ;
//
// /////
// console.log(data3, data4)
//
//
// var width = 800,
//     height = 250,
//     radius = Math.min(width, height) / 2;
// var legendRectSize = 18;                                  // NEW
// var legendSpacing = 4;                                    // NEW
//
// var color = d3.scale.ordinal()
//     .range(["#98abc5", "#8a89a6", "#7b6888", "#6b486b", "#a05d56", "#d0743c", "#ff8c00"]);
//
// var arc = d3.svg.arc()
//     .outerRadius(radius - 10)
//     .innerRadius(radius - 50);
//
// var pie = d3.layout.pie()
//     .sort(null)
//     .value(function(d) {
//         return d.count;
//     });
//
// var tooltip = d3.select('#chartDiv2')                               // NEW
//   .append('div')                                                // NEW
//   .attr('class', 'tooltip');                                    // NEW
//
// tooltip.append('div')                                           // NEW
//   .attr('class', 'label');                                      // NEW
//
// tooltip.append('div')                                           // NEW
//   .attr('class', 'count');                                      // NEW
//
// tooltip.append('div')                                           // NEW
//   .attr('class', 'percent');
//
//
// var svg = d3.select("#chartDiv2").append("svg")
//     .attr("width", width)
//     .attr("height", height)
//     .append("g")
//     .attr("id", "pieChart")
//     .attr("transform", "translate(" + width / 2 + "," + height / 2 + ")");
//
// var path = svg.selectAll("path")
//     .data(pie(data1))
//     .enter()
//     .append("path");
//
//
//
// path.transition()
//     .duration(500)
//     .attr("fill", function(d, i) {
//         return color(d.data.label);
//     })
//     .attr("d", arc)
//     .each(function(d) {
//         this._current = d;
//     }); // store the initial angles
//
// path.on('mouseover', function(d) {                            // NEW
//   var total = d3.sum(data1.map(function(d) {                // NEW
//     return d.count;                                           // NEW
//   }));                                                        // NEW
//   var percent = Math.round(1000 * d.data.count / total) / 10; // NEW
//   tooltip.select('.label').html(d.data.label);                // NEW
//   tooltip.select('.count').html(d.data.count);                // NEW
//   tooltip.select('.percent').html(percent + '%');             // NEW
//   tooltip.style('display', 'block');                          // NEW
// });                                                           // NEW
//
// path.on('mouseout', function() {                              // NEW
//   tooltip.style('display', 'none');                           // NEW
// });
//
// var legend = svg.selectAll('.legend')                     // NEW
//  .data(color.domain())                                   // NEW
//  .enter()                                                // NEW
//  .append('g')                                            // NEW
//  .attr('class', 'legend')                                // NEW
//  .attr('transform', function(d, i) {                     // NEW
//    var height = legendRectSize + legendSpacing;          // NEW
//    var offset =  height * color.domain().length / 2;     // NEW
//    var horz = -2 * legendRectSize;                       // NEW
//    var vert = i * height - offset;                       // NEW
//    return 'translate(' + horz + ',' + vert + ')';        // NEW
//  });                                                     // NEW
//
// legend.append('rect')                                     // NEW
//  .attr('width', legendRectSize)                          // NEW
//  .attr('height', legendRectSize)                         // NEW
//  .style('fill', color)                                   // NEW
//  .style('stroke', color);                                // NEW
//
// legend.append('text')                                     // NEW
//  .attr('x', legendRectSize + legendSpacing)              // NEW
//  .attr('y', legendRectSize - legendSpacing)              // NEW
//  .text(function(d) { return d; });                       // NEW                                    // NEW
//
//
//
// function change2(data) {
//     path.data(pie(data));
//     path.transition().duration(750).attrTween("d", arcTween); // redraw the arcs
//
// }
//
// // Store the displayed angles in _current.
// // Then, interpolate from _current to the new angles.
// // During the transition, _current is updated in-place by d3.interpolate.
//
// function arcTween(a) {
//     var i = d3.interpolate(this._current, a);
//     this._current = i(0);
//     return function(t) {
//         return arc(i(t));
//     };
// }


</script>
