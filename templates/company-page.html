{% extends 'base.html' %}
{% block content %}


    <p>

        {% for message in get_flashed_messages() %}
            {{ message }} 
        {% endfor %}
        
    </p>

    <h2>{{ display_company.name }}</h2>


    
    <h3>Diversity Details</h3>

    <div class="ethnic-chart">
        <h4>Company Gender</h4>
        <canvas id="donutChart3"></canvas>
        <div id="donutLegend3" class="chart-legend"></div>

    <div class="ethnic-chart2">
        <h4>Average Gender for Tech Companies</h4>
        <canvas id="donutChart4"></canvas>
        <div id="donutLegend4" class="chart-legend"></div>


    <div class="ethnic-bar-graph">
        <canvas id="barGraph1"></canvas>
        <div id="barLegend" class="chart-legend"></div>



    <script>



    var options = { responsive: true,
                    tooltipTemplate: "<%= value %>%",
                    multiTooltipTemplate: "<%= value %>%",
                    percentageInnerCutout : 65,
                };


    // Make donut chart of percent of men and women
    var ctx_donut_gender = $("#donutChart3").get(0).getContext("2d");

    $.get("/company-gender/{{ display_company.company_id }}.json", function (data) {
        var myDonutChart3 = new Chart(ctx_donut_gender).Doughnut(data.company, options);
        $('#donutLegend3').html(myDonutChart3.generateLegend());
    });

    var ctx_donut_gender_us = $("#donutChart4").get(0).getContext("2d");

    $.get("/company-gender/{{ display_company.company_id }}.json", function (data) {
        var myDonutChart4 = new Chart(ctx_donut_gender_us).Doughnut(data.us, options);
        $('#donutLegend4').html(myDonutChart4.generateLegend());
    });

    var ctx_bar_ethnic = $("#barGraph1").get(0).getContext("2d");

    $.get("/company-diversity/{{ display_company.company_id }}.json", function (data) {
        var myBarChart = new Chart(ctx_bar_ethnic).Bar(data, options);
        $('#barLegend').html(myBarChart.generateLegend());
    });

 


 google.load("search", "1");

    var newsSearch;

      function searchComplete() {

        // Check that we got results
        document.getElementById('content').innerHTML = '';
        if (newsSearch.results && newsSearch.results.length > 0) {
          for (var i = 0; i < newsSearch.results.length; i++) {

            // Create HTML elements for search results
            var p = document.createElement('p');
            p.classList.add("news-title");
            var a = document.createElement('a');
            var publNameDate = document.createElement('p');
            publNameDate.classList.add("publ-name-date");
            var content = document.createElement('p');
            content.classList.add("news-para");
            



            a.href="/news-search/v1/newsSearch.results[i].url;"
            a.innerHTML = newsSearch.results[i].title;
            publDate = newsSearch.results[i].publishedDate;
            publDate2 = publDate.slice(0,25);
            publName = newsSearch.results[i].publisher + ": ";
            publNameDate.innerHTML = publName.concat(publDate2);
            content.innerHTML = newsSearch.results[i].content;
            



            // Append search results to the HTML nodes
            p.appendChild(a);
            p.appendChild(publNameDate);
            p.appendChild(content);
           
            document.body.appendChild(p);

          }
        }
      }

      function onLoad() {

        // Create a News Search instance.
        newsSearch = new google.search.NewsSearch();
  
        // Set searchComplete as the callback function when a search is 
        // complete.  The newsSearch object will have results in it.
        newsSearch.setSearchCompleteCallback(this, searchComplete, null);

        // Specify search quer(ies)
        newsSearch.execute('{{ display_company.name }} Tech Diversity');

        // Include the required Google branding
        google.search.Search.getBranding('branding');
      }

      // Set a callback to call your code when the page loads
      google.setOnLoadCallback(onLoad);
   

    </script>

    
    <a href="/review/{{ display_company.company_id }}"><h3>Write a review</h3><a>



    <div id="reviews">
        <h3>Reviews</h3>
        <table style="width:100%">
            <tr>
                <th>Employee Status</th>
                <th>Rating</th>
                <th>Review Title</th>
                <th>Pros</th>
                <th>Cons</th>
            </tr>
            {% for review in reviews %}
            <tr>
                <td>{{ review.employee_status }}</td>
                <td>{{ review.rating }}</td> 
                <td>{{ review.review_title }}</td>
                <td>{{ review.pros }}</td>
                <td>{{ review.cons }}</td>
            </tr>
            {% endfor %}
        </table>
    </div>

    <br>
    <br>

    <div id="news">
        <h1>News</h1>
        <p id="content">Loading...<p>
    </div>
</div>


   <!--  <div id="branding"  style="float: left;"></div><br/> -->


{% endblock %}